

<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<style>
  html, body {
    height: 100%;
    padding: 0;
    margin: 0;
  }
  #map {
    /* configure the size of the map */
    width: 100%;
    height: 100%;
  }
</style>
</head>
<body>
<div id="map"></div>
<script>
  // initialize Leaflet
  var map = L.map('map');
  function onChange(e) {
      console.log("Change: " + JSON.stringify(map.getBounds()));
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            result = JSON.parse(this.responseText);
            for (i = 0; i < result.length; ++i) {
              item = result[i];
              console.log("Creating marker " + item["lat"] + ", " + item["lng"] + " with title " + item["title"])
              L.marker([item["lat"], item["lng"]]).addTo(map).bindPopup(item["title"])
              // L.popup().setLatLng(L.latlng(item["lat"], item["lng"]))
          }
        }
      };
      xhttp.open("POST", "http://localhost:5000/events", true);
      xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      xhttp.send(JSON.stringify(map.getBounds()))
      console.log(xhttp.responseText)
  }
  map.on('zoomend', onChange);
  map.on('load', onChange);
  map.on('moveend', onChange);
  map.setView({lon: 0, lat: 0}, 2);
  // add the OpenStreetMap tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
  }).addTo(map);

  // show the scale bar on the lower left corner
  L.control.scale().addTo(map);

  // show a marker on the map
  L.marker({lon: 0, lat: 0}).bindPopup('The center of the world').addTo(map);

  var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
}

map.on('click', onChange);
</script>
</body>
</html>